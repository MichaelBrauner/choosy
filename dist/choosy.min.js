function __classPrivateFieldGet(t,e,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t===e&&i:e.has(t))return"m"===s?i:"a"===s?i.call(t):i?i.value:e.get(t);throw new TypeError("Cannot read private member from an object whose class did not declare it")}function debounce(e,s){let i;return function(...t){clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),e(...t)},s)}}function getLastOfArray(t){return t[t.length-1]}function compareOptions(t,e){return t.value===e.value&&t.content===e.content}function merge(t,...e){for(var s of e)for(var i in s)null!=s[i]&&(t[i]=replaceValue(t[i],s[i]));return t}function replaceValue(s,t){return Array.isArray(s)&&Array.isArray(t)?t.map((t,e)=>replaceValue(s[e],t)):isObject(s)&&isObject(t)?merge(s,t):t}function isObject(t){return t&&t.constructor===Object}class Component{constructor(t,e){this.$app=t,this.element=e}get $store(){return this.$app.store}get $navigation(){return this.$app.navigation}get $event(){return this.$app.event}get $option(){return this.$app.store.options}get $textInput(){return this.$app.widget.tagList.textInput}get $widget(){return this.$app.widget}get $config(){return this.$app.config}}class OptionModel{constructor(t=void 0,e=void 0,s=void 0,i=void 0){this.value=t,this.content=e,this.selected=s,this.timestamp=i,void 0===this.selected&&(this.selected=this.decide()),void 0===this.timestamp&&(this.timestamp=this.decide()?Date.now():null)}static get Addition(){return new OptionModel("add")}isAddition(){return"add"===this.value&&this.isStateIndicator()}isBlanc(){return void 0===this.value&&this.isStateIndicator()}isFirstOf(t){return!t[this.getOwnIndexOf(t)-1]}getOwnIndexOf(t){return t.indexOf(this)}isStateIndicator(){return!this.content&&!this.selected&&!this.timestamp}decide(){return!(!this.value&&!this.content)&&this.selected}}var _Option_instances,_Option_clean;class Option extends Component{constructor(){super(...arguments),_Option_instances.add(this)}get all(){return this.options.filter(t=>!!t.content)}get allButSelected(){return this.options.filter(t=>!!t.content&&!this.isSelected(t)&&!this.isNew(t))}get startingWithInput(){return this.options.filter(t=>t.content.includes(this.$store.input)&&!t.selected)}get equalToInput(){return this.options.find(t=>t.content===this.$store.input)}get selected(){return this.options.filter(t=>t.selected).sort((t,e)=>t.timestamp-e.timestamp)}isSelected(t){t=this.findByTextContent(t.content);return t&&t.selected}findByTextContent(e){return this.options.find(t=>t.content===e)}findByOptionElement(e){return this.options.find(t=>null===e.value?t.content===e.innerHTML:e.value.startsWith("__new_option__")?!t.value&&t.content===e.innerHTML:t.value===e.value&&t.content===e.innerHTML)}choose(t=void 0){t?this.select(t):this.$navigation.item.isBlanc()?this.selectInputValue():this.selectNavigationItem()}append(t=void 0){return t?null:(t=this.options.push(this.getModel())-1,this.options[t])}getModel(t=void 0){return new OptionModel(null==t?void 0:t.value,null!=(t=null==t?void 0:t.innerHTML)?t:this.$store.input)}select(e){this.options.map(t=>{t.content===e.content&&(t.selected=!0,t.timestamp=Date.now())}),this.$event.emit("option_chosen",e)}unselect(e){this.options.map(t=>{t.content===e.content&&(t.selected=!1)}),null===e.value&&this.removeAllUnselectedNew(),this.$event.emit("option_unselected"),__classPrivateFieldGet(this,_Option_instances,"m",_Option_clean).call(this)}isNew(e){return!this.$store.initialData.find(t=>compareOptions(t,e))}get isListEmpty(){return!this.selected.length}selectNavigationItem(){this.$navigation.item.isAddition()?this.selectInputValue():this.select(this.$navigation.item)}selectInputValue(){this.select(this.append())}get allTaken(){var t;return!(!this.$config.options.limit||this.$app.config.options.limit>(null==(t=this.selected)?void 0:t.length))}removeAllUnselectedNew(){this.options=this.options.filter(t=>t.value||t.selected)}}_Option_instances=new WeakSet,_Option_clean=function(){this.options=this.options.filter(t=>!this.isNew(t)||t.selected)};class Store extends Component{constructor(t){super(t),this.input=null,this.initialData=[],this.options=new Option(this.$app)}get inputIsEmpty(){var t;return!this.input||(null==(t=this.input)?void 0:t.length)<=0}}class Config extends Component{constructor(t,e){super(t),this.options={enabled:!0,limit:null},e&&(this.options=merge(this.options,e))}resolveEnabled(){this.options.enabled&&this.$widget.enable(),this.options.enabled||this.$widget.disable()}}var _ResultListList_instances,_ResultListList_clean,_ResultListList_findOptionElementByDataOption,_ResultList_instances,_ResultList_clean,_Widget_instances,_Widget_focusInput,classnames={widget:"choosy-widget",input:"choosy-input",list:"choosy-list",item:"choosy-item",item_text_span:"choosy-item-text-span",remove_button:"choosy-remove-button",remove_button_svg:"choosy-remove-button-svg",result_list_container:"choosy-result-list-container",result_list:"choosy-result-list",result_list_item:"choosy-result-item",result_list_item_active:"active",add_item:"choosy-add-item"},elements={get textInput(){var t=this.create("input","text",[classnames.input]);return t.style.width="1ch",t},get widget(){var t=this.create("div",null,[classnames.widget]);return t.append(this.list),t.append(this.resultList),t},get list(){return this.create("div",null,[classnames.list])},get removeButton(){var t=this.create("button",null,[classnames.remove_button]);return t.append(this.removeSVG),t.tabIndex=-1,t},get removeSVG(){return(new DOMParser).parseFromString(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill="currentColor" class="${classnames.remove_button_svg}">
            <path fill-rule='evenodd'
                  d='M15.78 14.36a1 1 0 0 1-1.42 1.42l-2.82-2.83-2.83 2.83a1 1 0 1 1-1.42-1.42l2.83-2.82L7.3 8.7a1 1 0 0 1 1.42-1.42l2.83 2.83 2.82-2.83a1 1 0 0 1 1.42 1.42l-2.83 2.83 2.83 2.82z'></path>
            </svg>`,"text/html").body.firstChild},get resultList(){var t=this.create("div",null,[classnames.result_list_container]);return t.style.display="none",t},get resultListList(){return this.create("ul",null,[classnames.result_list])},get resultItem(){return this.create("li",null,[classnames.result_list_item])},get addItem(){var t=this.resultItem;return t.classList.add(classnames.add_item),t.innerHTML="Add new",t},get selectOption(){return this.create("option",null)},getItem(t){var e=this.create("div",null,[classnames.item]);return e.append(this.getItemTextSpan(t)),e.append(this.removeButton),e},getItemTextSpan(t){var e=this.create("span",null,[classnames.item_text_span]);return e.innerHTML=t,e},create(t,e=null,s=[]){const i=document.createElement(t);return e&&(i.type=e),s.forEach(t=>{i.classList.add(t)}),i}};class InitialElement extends Component{constructor(t,e){super(t,e),this.storeInitialData(),this.hide(),this.registerListeners()}hide(){this.element.style.display="none"}attachWidget(t){this.element.parentElement.append(t)}storeInitialData(){this.$app.store.initialData=Array.from(this.getAllOptions).map(t=>this.$store.options.getModel(t))}get getAllOptions(){return Array.from(this.element.querySelectorAll("option"))}appendOption(t){var e=elements.selectOption;return e.value="__new_option__"+t.content,e.innerHTML=t.content,this.element.append(e),e}registerListeners(){this.$event.on("option_chosen",()=>{this.update()}),this.$event.on("option_unselected",()=>{this.update()})}update(t=!0){this.element.querySelectorAll("option").forEach(t=>{var e;null!=(e=this.$store.options.findByOptionElement(t))&&e.selected?t.selected=!0:t.selected=!1}),t&&this.triggerChangeEvent()}triggerChangeEvent(){this.element.dispatchEvent(new Event("change"))}get isMultiple(){return this.element.multiple}updateOptionsData(){this.storeInitialData(),this.$option.options=Array.from(this.getAllOptions).map(t=>this.$store.options.getModel(t)),this.$widget.update(!1)}clean(){this.getAllOptions.forEach(t=>{this.isOptionNew(t)&&!this.isSelected(t)&&t.remove()})}isOptionNew(t){return t.value.startsWith("__new_option__")}isSelected(e){return!!this.$option.selected.find(t=>e.textContent===t.content)}isOptionCreated(e){return this.getAllOptions.find(t=>e.content===this.extractNewOptionsValue(t))}extractNewOptionsValue(t){if(this.isOptionNew(t))return t.value.replace("__new_option__","")}}class ResultListList extends Component{constructor(t,e){super(t),_ResultListList_instances.add(this),this.create(e),this.registerEventListener()}create(t){var e=elements.resultListList;t.append(e),this.element=e}destroy(){this.element.remove(),this.$event.off("navigation_action")}createListAndScroll(){this.createResultList(),this.scrollToView()}registerEventListener(){this.chooseListener(),this.$event.on("navigation_action",()=>{this.createListAndScroll()})}chooseListener(){this.element.addEventListener("click",t=>{t=t.target;t.matches(`li.${classnames.result_list_item}:not(.${classnames.add_item})`)?this.choose(t.innerHTML):t.matches("li."+classnames.add_item)&&this.choose()})}choose(t=void 0){t?this.$option.choose(this.$option.findByTextContent(t)):this.$option.equalToInput||this.$option.choose()}createListResults(){__classPrivateFieldGet(this,_ResultListList_instances,"m",_ResultListList_clean).call(this),this.append(this.results),!this.$option.equalToInput&&this.$textInput.hasMinLength&&this.appendAddItemToList()}createListAllResults(){__classPrivateFieldGet(this,_ResultListList_instances,"m",_ResultListList_clean).call(this),this.append(this.$option.allButSelected)}createResultList(){this.$app.resultListVoter.canOpenAll()&&this.createListAllResults(),this.$app.resultListVoter.canOpen()&&this.createListResults()}append(t){t.forEach(t=>{this.hasOption(t)||this.appendElementToList(this.createResultItem(t))})}hasOption(e){return Array.from(this.allListItems).find(t=>t.textContent===e.content)}appendAddItemToList(){var t;this.hasAddNewItem||(t=elements.addItem,this.$navigation.selectedItem.isAddition()&&t.classList.add(classnames.result_list_item_active),this.appendElementToList(t))}appendElementToList(t){this.element.append(t)}get hasAddNewItem(){return this.element.querySelector("."+classnames.add_item)}createResultItem(t){var e=elements.resultItem;return this.$navigation.isActive(t)&&e.classList.add(classnames.result_list_item_active),e.innerHTML=t.content,e}isEmpty(t){return!t.querySelectorAll(ResultListList.selector+" > ."+classnames.result_list_item).length}static get selector(){return"."+classnames.result_list}get allListItems(){return this.element.getElementsByTagName("li")}get results(){var t;return this.$app.resultListVoter.canOpenAll()?null!=(t=this.$option.all)?t:[]:this.$app.resultListVoter.canOpen()&&this.$textInput.hasMinLength?this.$option.startingWithInput:[]}get noneSelectedResults(){return this.results.filter(t=>!t.selected)}setResultBoxHeight(){var e=this.allListItems;let s=0;if(5<e.length)for(let t=0;t<5;t++)s+=e.item(t).offsetHeight;this.element.style.height=s?s+"px":"auto"}scrollToView(){var t=this.getActiveElement();t&&t.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})}getActiveElement(){var t=this.$navigation.item;return t?__classPrivateFieldGet(this,_ResultListList_instances,"m",_ResultListList_findOptionElementByDataOption).call(this,t):null}}_ResultListList_instances=new WeakSet,_ResultListList_clean=function(){var s=this.allListItems;for(let t=0,e=s.length;t!==e;++t)s[0].parentNode.removeChild(s[0])},_ResultListList_findOptionElementByDataOption=function(e){return e.isAddition()?this.element.querySelector("."+classnames.add_item):Array.from(this.allListItems).find(t=>(null==t?void 0:t.innerHTML)===(null==e?void 0:e.content))};class ResultList extends Component{constructor(t,e){super(t,e),_ResultList_instances.add(this),this.closeEvents=["widget_clicked_outside","input_pressed_esc","input_pressed_tab","window_blur"],this.appendList(),this.registerEventListener()}registerEventListener(){this.closeEvents.forEach(t=>{this.$event.on(t,()=>this.closeResultBox())}),this.$event.on("input_input_debounced",()=>{this.$store.inputIsEmpty?this.closeResultBox():(this.list.createResultList(),this.createBox())}),this.$event.on("input_focus",()=>{this.list.createResultList(),this.createBox()})}createBox(){this.openResultBox(),this.list.setResultBoxHeight()}openResultBox(){this.open||(this.element.style.display="block")}get open(){return"none"!==this.element.style.display}isOpen(t){return"block"===t.querySelector(ResultList.selector).style.display}closeResultBox(){__classPrivateFieldGet(this,_ResultList_instances,"m",_ResultList_clean).call(this),this.open&&(this.element.style.display="none"),this.$navigation.clear()}appendList(){this.list=new ResultListList(this.$app,this.element)}static get selector(){return"."+classnames.result_list_container}destroy(){this.list.destroy()}}_ResultList_instances=new WeakSet,_ResultList_clean=function(){this.destroy(),this.appendList()};class TextInput extends Component{constructor(t,e){super(t,e),this.registerListeners()}registerListeners(){this.element.addEventListener("input",()=>{this.refreshState(),this.adjustWidth()}),this.element.addEventListener("keydown",t=>{"Enter"===t.key&&this.enterKeyEvent(t),"Escape"===t.key&&this.escapeKeyEvent(),"Backspace"===t.key&&this.backspaceKeyEvent(t),"Tab"===t.key&&this.$event.emit("input_pressed_tab"),this.$navigation.events.handle(t)}),this.element.addEventListener("input",debounce(t=>{this.$event.emit("input_input_debounced",t)},250)),this.element.addEventListener("focus",()=>{console.log("hey"),this.$event.emit("input_focus")}),this.element.addEventListener("blur",t=>{this.$event.emit("input_blur",t)}),this.$event.on("input_cleared",this.resetValue)}get length(){var t;return null==(t=this.$store.input)?void 0:t.length}get hasMinLength(){return 2<=this.length}adjustWidth(){this.element.style.width=`${this.length?this.length+1:1}ch`}refreshState(){this.$store.input=this.element.value}limit(t){this.$app.optionVoter.canAdd()||t.preventDefault()}static get selector(){return"."+classnames.input}clear(){this.$store.input=null,this.$event.emit("input_cleared")}enterKeyEvent(t){t.preventDefault(),(this.hasMinLength||this.$app.optionVoter.canAdd())&&this.$option.choose()}escapeKeyEvent(){this.$event.emit("input_pressed_esc")}backspaceKeyEvent(t){this.$store.inputIsEmpty&&!this.$option.isListEmpty&&(t.preventDefault(),this.$option.unselect(getLastOfArray(this.$option.selected)))}get isFocussed(){return document.activeElement.classList.contains(classnames.input)}focus(){this.isFocussed||this.element.focus()}resetValue(){this&&(this.element.value=null)}destroy(){this.$event.off("input_cleared",this.resetValue)}disable(){this.element.setAttribute("disabled","")}}class TagList extends Component{constructor(t,e){super(t,e),this.appendTextInput(),this.registerEventListeners()}appendTextInput(){var t;this.textInput=new TextInput(this.$app,elements.textInput),null!=(t=this.$config)&&t.options.enabled||this.textInput.disable(),this.element.append(this.textInput.element)}registerEventListeners(){this.element.addEventListener("click",t=>{this.clickedOnRemoveButton(t.target)&&(t.preventDefault(),this.$option.unselect(this.$option.findByTextContent(this.findClickedTag(t).innerHTML)))})}clickedOnRemoveButton(t){return!!t.matches("button."+classnames.remove_button)||!!t.matches("svg."+classnames.remove_button_svg)||!!t.matches("path")}static create(t,e){const s=elements.list;return t.selected.forEach(t=>s.append(elements.getItem(t.content))),new TagList(e,s)}remove(){this.textInput.destroy(),this.element.remove()}findClickedTag(t){return t.target.closest("."+classnames.item).querySelector("."+classnames.item_text_span)}static get selector(){return"."+classnames.list}}class Widget extends Component{constructor(t,e){super(e,elements.widget),_Widget_instances.add(this),this.initialElement=new InitialElement(e,t),this.resultList=new ResultList(e,this.element.querySelector("."+classnames.result_list_container)),this.tagList=new TagList(e,this.element.querySelector("."+classnames.list)),this.initialElement.attachWidget(this.element),this.registerListeners()}registerListeners(){this.element.addEventListener("click",t=>{this.$app.inputVoter.shouldFocusOnWidgetClick(t)&&__classPrivateFieldGet(this,_Widget_instances,"m",_Widget_focusInput).call(this)}),this.$event.on("option_chosen",()=>{this.update(!1),__classPrivateFieldGet(this,_Widget_instances,"m",_Widget_focusInput).call(this)}),this.$event.on("option_unselected",()=>{this.update(!1),__classPrivateFieldGet(this,_Widget_instances,"m",_Widget_focusInput).call(this)})}update(t){this.appendNewSelectOptions(),this.initialElement.update(t),this.updateTagList(),this.closeResultListBox(),this.clearTextInput(),this.limit(),this.updateConfigOptions()}appendNewSelectOptions(){this.$option.all.forEach(t=>{this.$option.isNew(t)&&!this.initialElement.isOptionCreated(t)&&this.initialElement.appendOption(t)}),this.initialElement.clean()}updateTagList(){this.tagList.remove(),this.tagList=TagList.create(this.$option,this.$app),this.element.append(this.tagList.element)}closeResultListBox(){this.resultList.closeResultBox()}clearTextInput(){this.tagList.textInput.clear()}static get selector(){return"."+classnames.widget}limit(){this.$app.store.options.allTaken?this.tagList.textInput.element.maxLength=0:this.tagList.textInput.element.maxLength=524288}updateConfigOptions(){this.$config.resolveEnabled()}disable(){this.element.classList.add("disabled"),this.tagList.textInput.element.tabIndex=-1}enable(){this.element.classList.remove("disabled"),this.tagList.textInput.element.tabIndex=0}destroy(){this.tagList.remove(),this.resultList.destroy(),this.element.remove()}}_Widget_instances=new WeakSet,_Widget_focusInput=function(){this.tagList.textInput.focus()};class NavigationEvents extends Component{handle(t){"ArrowDown"===t.key&&(t.preventDefault(),this.arrowDownEvent(t)),"ArrowUp"===t.key&&(t.preventDefault(),this.arrowUpEvent(t))}arrowDownEvent(t){this.isNavigationEnabled(t)&&this.$navigation.down(),this.$event.emit("navigation_action","down")}arrowUpEvent(t){this.isNavigationEnabled(t)&&this.$navigation.up(),this.$event.emit("navigation_action","up")}isNavigationEnabled(t){t=this.getWidgetFromEvent(t);return this.$app.widget.resultList.isOpen(t)&&!this.$app.widget.resultList.list.isEmpty(t)}getWidgetFromEvent(t){return t.target.closest(Widget.selector)}}class Navigation extends Component{constructor(t){super(t),this.item=new OptionModel,this.events=new NavigationEvents(t)}up(){this.isStart()?this.$app.resultListVoter.canOpenAll()||this.selectedItem.isAddition()?this.move("toEnd"):this.switchToAdd():this.move("up")}down(){if(!this.isStart(!0)){if(this.isNotLast())return void this.move("down");if(this.selectedItem.isAddition())return void this.move("toFirst");if(this.hasNoValidResults())return void this.switchToAdd()}!this.$app.resultListVoter.canOpenAll()&&this.isLast()?this.selectedItem=OptionModel.Addition:this.move("toFirst")}clear(){this.selectedItem=new OptionModel}isActive(t){return t===this.selectedItem}get selectedItem(){return this.item}set selectedItem(t){this.item=t}switchToAdd(){this.selectedItem=OptionModel.Addition}move(t="down"){var e=this.freeResults;"down"===t&&(this.selectedItem=e[e.indexOf(this.selectedItem)+1]),"up"===t&&(this.selectedItem=e[e.indexOf(this.selectedItem)-1]),"toFirst"===t&&(this.selectedItem=e[0]),"toEnd"===t&&(this.selectedItem=e[e.length-1])}get freeResults(){return this.$app.widget.resultList.list.noneSelectedResults}isStart(t=!1){return t?this.selectedItem.isBlanc():this.selectedItem.isBlanc()||this.selectedItem.isFirstOf(this.freeResults)||this.selectedItem.isAddition()}isNotLast(){return this.freeResults.length>this.freeResults.indexOf(this.selectedItem)+1}isLast(){return!this.isNotLast()}hasNoValidResults(){return!this.freeResults.length}}class ResultListVoter extends Component{canOpenAll(){return this.$store.inputIsEmpty&&!this.$app.store.options.allTaken}canOpen(){return!this.$store.inputIsEmpty&&!this.$app.store.options.allTaken}}class OptionVoter extends Component{canAdd(){return!this.inputIsEmptyAndNothingIsSelected()&&!this.$app.store.options.allTaken}inputIsEmptyAndNothingIsSelected(){var t;return!(null!=(t=this.$store.input)&&t.length)&&this.$option.getModel().isBlanc()&&this.$navigation.item.isBlanc()}}class InputVoter extends Component{constructor(t){super(t)}shouldFocusOnWidgetClick(t){return!t.target.classList.contains(classnames.result_list_item)&&!!this.$config.options.enabled&&(t.target.classList.contains(classnames.list)||!t.target.closest(TagList.selector))}}class AppEvent{constructor(){this.subscribers={}}on(t,e){Array.isArray(this.subscribers[t])||(this.subscribers[t]=[]),this.subscribers[t].push(e)}off(t,e=void 0){this.subscribers[t]=e?this.subscribers[t].filter(t=>t!==e):[]}emit(t,e=void 0){Array.isArray(this.subscribers[t])&&this.subscribers[t].forEach(t=>{t(e)})}}class Choosy{constructor(t,e){this.clickedOutsideOfWidgetEvent=t=>{this.widget.element.contains(t.target)||this.isClickOnTagList(t)||this.event.emit("widget_clicked_outside")},this.windowBlurEvent=()=>{this.event.emit("window_blur")},t&&(this.store=new Store(this),this.event=new AppEvent,this.widget=new Widget(t,this),this.config=new Config(this,e),this.navigation=new Navigation(this),this.resultListVoter=new ResultListVoter(this),this.optionVoter=new OptionVoter(this),this.inputVoter=new InputVoter(this),(this.widget.initialElement.element.__x=this).initializeData(),this.registerEventListener(),this.resolveOptions(),this.widget.update(!1))}registerEventListener(){document.addEventListener("click",this.clickedOutsideOfWidgetEvent),window.addEventListener("blur",this.windowBlurEvent)}removeEventListeners(){document.removeEventListener("click",this.clickedOutsideOfWidgetEvent),window.removeEventListener("blur",this.windowBlurEvent)}isClickOnTagList(t){return!!t.target.closest(TagList.selector)}initializeData(){this.store.options.options=Array.from(this.store.initialData)}resolveOptions(){this.widget.initialElement.isMultiple||(this.config.options.limit=1)}disable(){this.config.options.enabled=!1,this.widget.disable()}enable(){this.config.options.enabled=!0,this.widget.enable()}clear(){this.widget.destroy(),this.removeEventListeners(),this.store=void 0,this.event=void 0,this.config=void 0,this.navigation=void 0,this.resultListVoter=void 0,this.optionVoter=void 0,this.inputVoter=void 0,this.widget.initialElement.element.__x=void 0}}export{Choosy as default};
//# sourceMappingURL=choosy.min.js.map
